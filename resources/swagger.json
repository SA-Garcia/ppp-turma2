{
  "openapi": "3.0.0",
  "info": {
    "title": "API de Incidentes de Segurança Pública",
    "version": "1.0.0",
    "description": "API para registro e monitoramento de incidentes de segurança pública com autenticação JWT."
  },
  "servers": [
    { "url": "/api" }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "email": { "type": "string" },
          "role": { "type": "string", "enum": ["user"] }
        }
      },
      "Official": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "email": { "type": "string" },
          "org": { "type": "string" },
          "role": { "type": "string", "enum": ["official"] }
        }
      },
      "Incident": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "type": { "type": "string" },
          "description": { "type": "string" },
          "latitude": { "type": "number" },
          "longitude": { "type": "number" },
          "reporterIds": { "type": "array", "items": { "type": "string" } },
          "status": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" }
        }
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "tags": [
    { "name": "Cidadão", "description": "Cadastro e login do cidadão" },
    { "name": "Servidor Público", "description": "Cadastro, login e visualização de servidores públicos" },
    { "name": "Ocorrências", "description": "Ocorrências e incidentes cadastrados" }
  ],
  "paths": {
    "/users/register": {
      "post": {
        "tags": ["Cidadão"],
        "summary": "Cadastro de cidadão",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["name", "email", "password"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Cidadão cadastrado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/User" } } } },
          "400": { "description": "Erro de validação" }
        }
      }
    },
    "/users/login": {
      "post": {
        "tags": ["Cidadão"],
        "summary": "Login do cidadão",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Token JWT", "content": { "application/json": { "schema": { "type": "object", "properties": { "token": { "type": "string" } } } } } },
          "401": { "description": "Credenciais inválidas" }
        }
      }
    },
    "/officials/register": {
      "post": {
        "tags": ["Servidor Público"],
        "summary": "Cadastro de servidor público (restrito)",
    "/officials/{id}": {
      "get": {
        "tags": ["Servidor Público"],
        "summary": "Visualizar cadastro público de servidor (restrito)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Dados públicos do servidor (apenas para servidores públicos autenticados)", "content": { "application/json": { "schema": { "type": "object", "properties": { "id": { "type": "string" }, "org": { "type": "string" } } } } } },
          "401": { "description": "Não autorizado" },
          "403": { "description": "Acesso restrito a servidor público" },
          "404": { "description": "Servidor público não encontrado" }
        }
      }
    },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string" },
                  "password": { "type": "string" },
                  "org": { "type": "string" }
                },
                "required": ["name", "email", "password", "org"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Servidor público cadastrado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Official" } } } },
          "400": { "description": "Erro de validação" }
        }
      }
    },
    "/officials/login": {
      "post": {
        "tags": ["Servidor Público"],
        "summary": "Login do servidor público",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Token JWT", "content": { "application/json": { "schema": { "type": "object", "properties": { "token": { "type": "string" } } } } } },
          "401": { "description": "Credenciais inválidas" }
        }
      }
    },
    "/incidents/types": {
      "get": {
        "tags": ["Ocorrências"],
        "summary": "Listar tipos de ocorrência",
        "responses": {
          "200": { "description": "Lista de tipos de ocorrência", "content": { "application/json": { "schema": { "type": "array", "items": { "type": "string" } } } } }
        }
      }
    },
    "/incidents": {
      "post": {
        "tags": ["Ocorrências"],
        "summary": "Criar incidente (cidadão)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "type": { "type": "string" },
                  "description": { "type": "string" },
                  "latitude": { "type": "number" },
                  "longitude": { "type": "number" }
                },
                "required": ["type", "description", "latitude", "longitude"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Incidente criado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Incident" } } } },
          "400": { "description": "Erro de validação" },
          "401": { "description": "Não autorizado" }
        }
      },
      "get": {
        "tags": ["Ocorrências"],
        "summary": "Listar incidentes",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Lista de incidentes", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Incident" } } } } },
          "401": { "description": "Não autorizado" }
        }
      }
    },
    "/incidents/{id}": {
      "get": {
        "tags": ["Ocorrências"],
        "summary": "Buscar incidente por ID",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Incidente encontrado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Incident" } } } },
          "404": { "description": "Incidente não encontrado" },
          "401": { "description": "Não autorizado" }
        }
      }
    },
    "/incidents/{id}/status": {
      "patch": {
        "tags": ["Ocorrências"],
        "summary": "Alterar status do incidente (servidor público)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": { "type": "string", "enum": ["em andamento", "finalizado"] }
                },
                "required": ["status"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Status alterado", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Incident" } } } },
          "400": { "description": "Status inválido" },
          "403": { "description": "Acesso restrito a servidor público" },
          "404": { "description": "Incidente não encontrado" },
          "401": { "description": "Não autorizado" }
        }
      }
    }
  }
}
